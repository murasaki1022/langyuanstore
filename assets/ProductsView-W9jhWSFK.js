import{a as P}from"./axios-L6U4YIEh.js";import{M as w}from"./bootstrap.esm-owtkFIww.js";import{_ as M,o as i,c as n,b as t,e as U,t as m,A as a,B as c,F as y,u as x,G as k,bt as V,d as g,r as v}from"./index-nPiBQWoP.js";import{P as I}from"./PaginationComponent-dZQAMX7s.js";const E={data(){return{delProductModal:null}},methods:{openModal(){this.delProductModal.show()},hideModal(){this.delProductModal.hide()}},props:["tempProduct","deleteProduct"],mounted(){this.delProductModal=new w(this.$refs.delProductModal,{keyboard:!1,backdrop:"static"})}},C={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},L={class:"modal-dialog"},N={class:"modal-content border-0"},D=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),T={class:"modal-body"},$={class:"text-danger"},R={class:"modal-footer"},S=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function F(l,e,d,_,o,r){return i(),n("div",C,[t("div",L,[t("div",N,[D,t("div",T,[U(" 是否刪除 "),t("strong",$,m(d.tempProduct.title),1),U(" 商品(刪除後將無法恢復)。 ")]),t("div",R,[S,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=(...s)=>d.deleteProduct&&d.deleteProduct(...s))}," 確認刪除 ")])])])],512)}const B=M(E,[["render",F]]);var O={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io",VITE_APP_API_NAME:"langyuanstore",BASE_URL:"/langyuanstore/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:q,VITE_APP_API_NAME:G}=O,j={data(){return{productModal:null,editProduct:{},newImageUrl:[]}},props:["tempProduct","updateProduct","isNew"],methods:{openModal(){this.productModal.show()},hideModal(){this.productModal.hide()},uploadFile(){const l=`${q}/api/${G}/admin/upload`,e=document.querySelector("#formFileSm"),d=e.files[0],_=new FormData;_.append("file-to-upload",d),P.post(l,_).then(o=>{this.newImageUrl=o.data.imageUrl,e.value=null}).catch(o=>{console.log(o)})},copyUrl(){const l=document.querySelector("#newImage");navigator.clipboard.writeText(l.value).then(()=>{this.newImageUrl=""}).catch(e=>{console.error("複製失敗",e)})}},watch:{tempProduct(){this.editProduct=this.tempProduct}},mounted(){this.productModal=new w(this.$refs.productModal,"productModal",{keyboard:!1,backdrop:"static"}),this.editProduct=this.tempProduct}},z={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},H={class:"modal-dialog modal-xl"},J={class:"modal-content border-0"},K={class:"modal-header bg-dark text-white"},Q={id:"productModalLabel",class:"modal-title"},W={key:0},X={key:1},Y=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Z={class:"modal-body"},tt={class:"row"},et={class:"col-sm-4"},ot={class:"mb-3"},st=t("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),dt=["src"],lt=t("h3",null,"上傳圖片",-1),it={action:"/api/thisismycourse2/admin/upload",enctype:"multipart/form-data",method:"post"},nt={class:"input-group mb-3"},rt=t("input",{class:"form-control form-control-sm",id:"formFileSm",type:"file","aria-describedby":"button-addon2"},null,-1),at={class:"input-group mb-3"},ct=t("h3",{class:"mb-3"},"多圖新增",-1),ut={key:0},pt={class:"mb-3"},mt=["for"],_t=["id","onUpdate:modelValue"],ht=["src"],bt={key:0},Pt={key:1},ft={class:"col-sm-8"},gt={class:"mb-3"},vt=t("label",{for:"title",class:"form-label"},"標題",-1),yt={class:"row"},Mt={class:"mb-3 col-md-6"},Ut=t("label",{for:"category",class:"form-label"},"分類",-1),wt={class:"mb-3 col-md-6"},xt=t("label",{for:"unit",class:"form-label"},"單位",-1),At={class:"row"},kt={class:"mb-3 col-md-6"},Vt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),It={class:"mb-3 col-md-6"},Et=t("label",{for:"price",class:"form-label"},"售價",-1),Ct=t("hr",null,null,-1),Lt={class:"mb-3"},Nt=t("label",{for:"description",class:"form-label"},"產品描述",-1),Dt={class:"mb-3"},Tt=t("label",{for:"content",class:"form-label"},"說明內容",-1),$t={class:"mb-3"},Rt={class:"form-check"},St=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Ft={class:"modal-footer"},Bt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Ot(l,e,d,_,o,r){return i(),n("div",z,[t("div",H,[t("div",J,[t("div",K,[t("h5",Q,[d.isNew?(i(),n("span",W,"新增產品")):(i(),n("span",X,"編輯產品"))]),Y]),t("div",Z,[t("div",tt,[t("div",et,[t("div",ot,[st,a(t("input",{id:"imageUrl","onUpdate:modelValue":e[0]||(e[0]=s=>o.editProduct.imageUrl=s),type:"text",class:"form-control mb-2",placeholder:"請輸入圖片連結"},null,512),[[c,o.editProduct.imageUrl]]),t("img",{class:"img-fluid",src:o.editProduct.imageUrl},null,8,dt)]),lt,t("form",it,[t("div",nt,[rt,t("button",{class:"btn btn-outline-primary btn-sm",type:"button",id:"button-addon2",onClick:e[1]||(e[1]=(...s)=>r.uploadFile&&r.uploadFile(...s))},"上傳")]),t("div",at,[a(t("input",{class:"form-control form-control-sm",type:"text",id:"newImage","onUpdate:modelValue":e[2]||(e[2]=s=>o.newImageUrl=s)},null,512),[[c,o.newImageUrl]]),t("button",{class:"btn btn-outline-primary btn-sm",type:"button",id:"btn",onClick:e[3]||(e[3]=(...s)=>r.copyUrl&&r.copyUrl(...s))}," 複製URL ")])]),ct,Array.isArray(o.editProduct.imagesUrl)?(i(),n("div",ut,[(i(!0),n(y,null,x(o.editProduct.imagesUrl,(s,p)=>(i(),n("div",{class:"mb-1",key:p+456},[t("div",pt,[t("label",{for:s[p],class:"form-label"},"圖片網址"+m(p+1),9,mt),a(t("input",{id:s[p],"onUpdate:modelValue":f=>o.editProduct.imagesUrl[p]=f,type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,8,_t),[[c,o.editProduct.imagesUrl[p]]])]),t("img",{class:"img-fluid",src:s},null,8,ht)]))),128)),!o.editProduct.imagesUrl.length||o.editProduct.imagesUrl[o.editProduct.imagesUrl.length-1]?(i(),n("div",bt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[4]||(e[4]=s=>o.editProduct.imagesUrl.push(""))}," 新增圖片 ")])):(i(),n("div",Pt,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[5]||(e[5]=s=>o.editProduct.imagesUrl.pop())}," 刪除圖片 ")]))])):k("",!0)]),t("div",ft,[t("div",gt,[vt,a(t("input",{id:"title","onUpdate:modelValue":e[6]||(e[6]=s=>o.editProduct.title=s),type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[c,o.editProduct.title]])]),t("div",yt,[t("div",Mt,[Ut,a(t("input",{id:"category","onUpdate:modelValue":e[7]||(e[7]=s=>o.editProduct.category=s),type:"text",class:"form-control",placeholder:"請輸入分類"},null,512),[[c,o.editProduct.category]])]),t("div",wt,[xt,a(t("input",{id:"unit","onUpdate:modelValue":e[8]||(e[8]=s=>o.editProduct.unit=s),type:"text",class:"form-control",placeholder:"請輸入單位"},null,512),[[c,o.editProduct.unit]])])]),t("div",At,[t("div",kt,[Vt,a(t("input",{id:"origin_price","onUpdate:modelValue":e[9]||(e[9]=s=>o.editProduct.origin_price=s),type:"number",min:"0",class:"form-control",placeholder:"請輸入原價"},null,512),[[c,o.editProduct.origin_price,void 0,{number:!0}]])]),t("div",It,[Et,a(t("input",{id:"price","onUpdate:modelValue":e[10]||(e[10]=s=>o.editProduct.price=s),type:"number",min:"0",class:"form-control",placeholder:"請輸入售價"},null,512),[[c,o.editProduct.price,void 0,{number:!0}]])])]),Ct,t("div",Lt,[Nt,a(t("textarea",{id:"description","onUpdate:modelValue":e[11]||(e[11]=s=>o.editProduct.description=s),type:"text",class:"form-control",placeholder:"請輸入產品描述"},`\r
              `,512),[[c,o.editProduct.description]])]),t("div",Dt,[Tt,a(t("textarea",{id:"content","onUpdate:modelValue":e[12]||(e[12]=s=>o.editProduct.content=s),type:"text",class:"form-control",placeholder:"請輸入說明內容"},`\r
              `,512),[[c,o.editProduct.content]])]),t("div",$t,[t("div",Rt,[a(t("input",{id:"is_enabled","onUpdate:modelValue":e[13]||(e[13]=s=>o.editProduct.is_enabled=s),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[V,o.editProduct.is_enabled]]),St])])])])]),t("div",Ft,[Bt,t("button",{type:"button",class:"btn btn-primary",onClick:e[14]||(e[14]=(...s)=>d.updateProduct&&d.updateProduct(...s))}," 確認 ")])])])],512)}const qt=M(j,[["render",Ot]]);var Gt={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io",VITE_APP_API_NAME:"langyuanstore",BASE_URL:"/langyuanstore/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:h,VITE_APP_API_NAME:b}=Gt,jt={data(){return{products:[],isNew:!1,tempProduct:{imagesUrl:[]},pages:{}}},methods:{getProductList(l=1){const e=`${h}/v2/api/${b}/admin/products?page=${l}`;P.get(e).then(d=>{this.products=d.data.products,this.pages=d.data.pagination}).catch(d=>{console.log(d)})},openModal(l,e){l==="new"?(this.tempProduct={imagesUrl:[]},this.isNew=!0,this.$refs.pModal.openModal()):l==="edit"?(this.tempProduct={...e},Array.isArray(this.tempProduct.imagesUrl)||(this.tempProduct.imagesUrl=[]),this.isNew=!1,this.$refs.pModal.openModal()):l==="delete"&&(this.tempProduct={...e},this.$refs.removeModal.openModal())},updateProduct(){let l=`${h}/v2/api/${b}/admin/product/${this.tempProduct.id}`,e="put";this.isNew&&(l=`${h}/v2/api/${b}/admin/product`,e="post"),P[e](l,{data:this.tempProduct}).then(d=>{alert(d.data.message),this.$refs.pModal.hideModal(),this.getProductList()}).catch(d=>{alert(d.data.message)})},deleteProduct(){const l=`${h}/v2/api/${b}/admin/product/${this.tempProduct.id}`;P.delete(l).then(e=>{alert(e.data.message),this.$refs.removeModal.hideModal(),this.getProductList()}).catch(e=>{alert(e.data.message)})}},components:{DeleteProductModal:B,PaginationComponent:I,ProductsModal:qt},mounted(){this.getProductList()}},zt={class:"text-end"},Ht={class:"table mt-4"},Jt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",{width:"120"},"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"100"},"編輯")])],-1),Kt={class:"text-end"},Qt={class:"text-end"},Wt={key:0,class:"text-success"},Xt={key:1},Yt={class:"btn-group"},Zt=["onClick"],te=["onClick"];function ee(l,e,d,_,o,r){const s=v("PaginationComponent"),p=v("ProductsModal"),f=v("DeleteProductModal");return i(),n(y,null,[t("div",zt,[t("button",{class:"btn btn-primary mt-4",onClick:e[0]||(e[0]=u=>r.openModal("new"))}," 建立新的產品 ")]),t("table",Ht,[Jt,t("tbody",null,[(i(!0),n(y,null,x(o.products,u=>(i(),n("tr",{key:u.id},[t("td",null,m(u.category),1),t("td",null,m(u.title),1),t("td",Kt,"$"+m(u.origin_price),1),t("td",Qt,"$"+m(u.price),1),t("td",null,[u.is_enabled?(i(),n("span",Wt,"啟用")):(i(),n("span",Xt,"未啟用"))]),t("td",null,[t("div",Yt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:A=>r.openModal("edit",u)}," 編輯 ",8,Zt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:A=>r.openModal("delete",u)}," 刪除 ",8,te)])])]))),128))])]),g(s,{pages:o.pages,onChangePages:r.getProductList},null,8,["pages","onChangePages"]),g(p,{"update-product":r.updateProduct,"temp-product":o.tempProduct,isNew:o.isNew,ref:"pModal"},null,8,["update-product","temp-product","isNew"]),g(f,{"temp-product":o.tempProduct,"delete-product":r.deleteProduct,ref:"removeModal"},null,8,["temp-product","delete-product"])],64)}const ie=M(jt,[["render",ee]]);export{ie as default};
