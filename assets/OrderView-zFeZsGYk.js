import{a as p}from"./axios-L6U4YIEh.js";import{M as v}from"./bootstrap.esm-owtkFIww.js";import{_ as y,o as d,c as s,b as e,e as k,t as o,G as M,F as u,u as g,A as x,bt as $,d as m,r as b,C as P}from"./index-nPiBQWoP.js";import{P as L}from"./PaginationComponent-dZQAMX7s.js";const V={data(){return{delOrderModal:null}},methods:{openModal(){this.delOrderModal.show()},hideModal(){this.delOrderModal.hide()}},props:["tempOrder","deleteOrder"],mounted(){this.delOrderModal=new v(this.$refs.delOrderModal,{keyboard:!1,backdrop:"static"})}},A={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},D={class:"modal-dialog"},E={class:"modal-content border-0"},I=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delOrderModalLabel",class:"modal-title"},[e("span",null,"刪除訂單")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),N={class:"modal-body"},S={class:"text-danger"},U={class:"modal-footer"},R=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function T(n,l,a,h,t,_){return d(),s("div",A,[e("div",D,[e("div",E,[I,e("div",N,[k(" 是否刪除 "),e("strong",S,"訂單"+o(a.tempOrder.id),1),k(" (刪除後將無法恢復)。 ")]),e("div",U,[R,e("button",{type:"button",class:"btn btn-danger",onClick:l[0]||(l[0]=(...i)=>a.deleteOrder&&a.deleteOrder(...i))}," 確認刪除 ")])])])],512)}const B=y(V,[["render",T]]),q={data(){return{orderModal:null,editOrder:{},is_paid:!1}},props:["tempOrder","updateOrder"],methods:{openModal(){this.orderModal.show()},hideModal(){this.orderModal.hide()}},watch:{tempOrder(){this.editOrder=this.tempOrder}},mounted(){this.orderModal=new v(this.$refs.orderModal,"orderModal",{keyboard:!1,backdrop:"static"}),this.editOrder=this.tempOrder}},F={class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"orderModal"},j={class:"modal-dialog modal-xl",role:"document"},z={class:"modal-content border-0"},G=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),H={class:"modal-body"},J={class:"row"},K={class:"col-md-4"},Q=e("h3",null,"用戶資料",-1),W={class:"table"},X={key:0},Y=e("th",{style:{width:"100px"}},"姓名",-1),Z=e("th",null,"Email",-1),ee=e("th",null,"電話",-1),te=e("th",null,"地址",-1),de={class:"col-md-8"},se=e("h3",null,"訂單細節",-1),oe={class:"table"},le=e("th",{style:{width:"100px"}},"訂單編號",-1),re=e("th",null,"下單時間",-1),ne=e("th",null,"付款時間",-1),ae={key:0},ie={key:1},ce=e("th",null,"付款狀態",-1),_e={key:0,class:"text-success"},he={key:1,class:"text-muted"},ue=e("th",null,"總金額",-1),pe=e("h3",null,"選購商品",-1),me={class:"table"},be=e("thead",null,[e("tr")],-1),Oe={class:"text-end"},fe={class:"d-flex justify-content-end"},Me={class:"form-check"},ge={class:"form-check-label",for:"flexCheckDefault"},ye={key:0},ke={key:1},ve={class:"modal-footer"},xe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function $e(n,l,a,h,t,_){return d(),s("div",F,[e("div",j,[e("div",z,[G,e("div",H,[e("div",J,[e("div",K,[Q,e("table",W,[t.editOrder.user?(d(),s("tbody",X,[e("tr",null,[Y,e("td",null,o(t.editOrder.user.name),1)]),e("tr",null,[Z,e("td",null,o(t.editOrder.user.email),1)]),e("tr",null,[ee,e("td",null,o(t.editOrder.user.tel),1)]),e("tr",null,[te,e("td",null,o(t.editOrder.user.address),1)])])):M("",!0)])]),e("div",de,[se,e("table",oe,[e("tbody",null,[e("tr",null,[le,e("td",null,o(t.editOrder.id),1)]),e("tr",null,[re,e("td",null,o(),1)]),e("tr",null,[ne,e("td",null,[t.editOrder.paid_date?(d(),s("span",ae,o(),1)):(d(),s("span",ie,"時間不正確"))])]),e("tr",null,[ce,e("td",null,[t.editOrder.is_paid?(d(),s("strong",_e,"已付款")):(d(),s("span",he,"尚未付款"))])]),e("tr",null,[ue,e("td",null,o(),1)])])]),pe,e("table",me,[be,e("tbody",null,[(d(!0),s(u,null,g(t.editOrder.products,i=>(d(),s("tr",{key:i.id},[e("th",null,o(i.product.title),1),e("td",null,o(i.qty)+" / "+o(i.product.unit),1),e("td",Oe,o(),1)]))),128))])]),e("div",fe,[e("div",Me,[x(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":l[0]||(l[0]=i=>t.editOrder.is_paid=i)},null,512),[[$,t.editOrder.is_paid]]),e("label",ge,[t.editOrder.is_paid?(d(),s("span",ye,"已付款")):(d(),s("span",ke,"未付款"))])])])])])]),e("div",ve,[xe,e("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=i=>a.updateOrder(t.editOrder))}," 修改付款狀態 ")])])])],512)}const Ce=y(q,[["render",$e]]);var we={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io",VITE_APP_API_NAME:"langyuanstore",BASE_URL:"/langyuanstore/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:O,VITE_APP_API_NAME:f}=we,Pe={data(){return{orders:[],tempOrder:{},pages:{}}},methods:{getOrderList(n=1){const l=`${O}/v2/api/${f}/admin/orders?page=${n}`;p.get(l).then(a=>{this.orders=a.data.orders,this.pages=a.data.pagination}).catch(a=>{console.log(a.response.data.message)})},openOrderModal(n){this.tempOrder={...n},this.$refs.orderModal.openModal()},openDelOrderModal(n){this.tempOrder={...n},this.$refs.removeModal.openModal()},updateOrder(n){const l=`${O}/v2/api/${f}/admin/order/${n.id}`,a={is_paid:n.is_paid};p.put(l,{data:a}).then(h=>{alert(h.data.message),this.$refs.orderModal.hideModal(),this.getOrderList()}).catch(h=>{console.log(h.response.data.message),alert(h.response.data.message)})},deleteOrder(){const n=`${O}/v2/api/${f}/admin/order/${this.tempOrder.id}`;p.delete(n).then(l=>{alert(l.data.message),this.$refs.removeModal.hideModal(),this.getOrderList()}).catch(l=>{alert(l.data.message)})}},components:{DeleteOrderModal:B,OrderModal:Ce,PaginationComponent:L},mounted(){this.getOrderList()}},Le={class:"table mt-4"},Ve=e("thead",null,[e("tr",null,[e("th",{width:"80"},"購買時間"),e("th",{width:"60"},"Email"),e("th",{width:"150"},"購買品項"),e("th",{width:"80"},"應付金額"),e("th",{width:"60"},"是否付款"),e("th",{width:"60"},"編輯")])],-1),Ae=["textContent"],De={class:"list-unstyled"},Ee={class:"text-right"},Ie={class:"form-check form-switch"},Ne=["id","onUpdate:modelValue","onChange"],Se=["for"],Ue={key:0},Re={key:1},Te={class:"btn-group"},Be=["onClick"],qe=["onClick"];function Fe(n,l,a,h,t,_){const i=b("PaginationComponent"),C=b("OrderModal"),w=b("DeleteOrderModal");return d(),s(u,null,[e("table",Le,[Ve,e("tbody",null,[(d(!0),s(u,null,g(t.orders,r=>(d(),s(u,{key:r.id},[t.orders.length?(d(),s("tr",{key:0,class:P({"text-secondary":!r.is_paid})},[e("td",null,o(r.create_at),1),e("td",null,[r.user?(d(),s("span",{key:0,textContent:o(r.user.email)},null,8,Ae)):M("",!0)]),e("td",null,[e("ul",De,[(d(!0),s(u,null,g(r.products,c=>(d(),s("li",{key:c.id},o(c.product.title)+" 數量："+o(c.qty)+" "+o(c.product.unit),1))),128))])]),e("td",Ee,"$"+o(r.total),1),e("td",null,[e("div",Ie,[x(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${r.id}`,"onUpdate:modelValue":c=>r.is_paid=c,onChange:c=>_.updateOrder(r)},null,40,Ne),[[$,r.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${r.id}`},[r.is_paid?(d(),s("span",Ue,"已付款")):(d(),s("span",Re,"未付款"))],8,Se)])]),e("td",null,[e("div",Te,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:c=>_.openOrderModal(r)}," 檢視 ",8,Be),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:c=>_.openDelOrderModal(r)}," 刪除 ",8,qe)])])],2)):M("",!0)],64))),128))])]),m(i,{pages:t.pages,onChangePages:_.getOrderList},null,8,["pages","onChangePages"]),m(C,{"temp-order":t.tempOrder,"update-order":_.updateOrder,ref:"orderModal"},null,8,["temp-order","update-order"]),m(w,{"temp-order":t.tempOrder,"delete-order":_.deleteOrder,ref:"removeModal"},null,8,["temp-order","delete-order"])],64)}const Je=y(Pe,[["render",Fe]]);export{Je as default};
