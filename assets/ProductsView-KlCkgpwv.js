import{a as P}from"./axios-L6U4YIEh.js";import{M as k}from"./bootstrap.esm-owtkFIww.js";import{_ as f,o as i,c as n,a as t,d as x,t as m,x as y,F as g,m as w,u as a,v as c,A as V,bp as I,b as M,r as U}from"./index-f7deKG2Z.js";const C={data(){return{delProductModal:null}},methods:{openModal(){this.delProductModal.show()},hideModal(){this.delProductModal.hide()}},props:["tempProduct","deleteProduct"],mounted(){this.delProductModal=new k(this.$refs.delProductModal,{keyboard:!1,backdrop:"static"})}},E={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},L={class:"modal-dialog"},$={class:"modal-content border-0"},N=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),D={class:"modal-body"},T={class:"text-danger"},R={class:"modal-footer"},S=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function F(l,e,d,_,o,r){return i(),n("div",E,[t("div",L,[t("div",$,[N,t("div",D,[x(" 是否刪除 "),t("strong",T,m(d.tempProduct.title),1),x(" 商品(刪除後將無法恢復)。 ")]),t("div",R,[S,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=(...s)=>d.deleteProduct&&d.deleteProduct(...s))}," 確認刪除 ")])])])],512)}const B=f(C,[["render",F]]),O={props:["pages","getProductList"]},q={"aria-label":"Page navigation example"},z={class:"pagination"},j=t("span",{"aria-hidden":"true"},"«",-1),G=[j],H=["onClick"],J=t("span",{"aria-hidden":"true"},"»",-1),K=[J];function Q(l,e,d,_,o,r){return i(),n("nav",q,[t("ul",z,[t("li",{class:y(["page-item",{disabled:!d.pages.has_pre}])},[t("a",{class:"page-link","aria-label":"Previous",onClick:e[0]||(e[0]=s=>d.getProductList(d.pages.current_page-1))},G)],2),(i(!0),n(g,null,w(d.pages.total_pages,s=>(i(),n("li",{class:y(["page-item",{active:s===d.pages.current_page}]),key:s+123},[t("a",{class:"page-link",onClick:u=>d.getProductList(s)},m(s),9,H)],2))),128)),t("li",{class:y(["page-item",{disabled:!d.pages.has_next}])},[t("a",{class:"page-link","aria-label":"Next",onClick:e[1]||(e[1]=s=>d.getProductList(d.pages.current_page+1))},K)],2)])])}const W=f(O,[["render",Q]]);var X={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io",VITE_APP_API_NAME:"langyuanstore",BASE_URL:"/langyuanstore/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:Y,VITE_APP_API_NAME:Z}=X,tt={data(){return{productModal:null,editProduct:{},newImageUrl:[]}},props:["tempProduct","updateProduct","isNew"],methods:{openModal(){this.productModal.show()},hideModal(){this.productModal.hide()},uploadFile(){const l=`${Y}/api/${Z}/admin/upload`,e=document.querySelector("#formFileSm"),d=e.files[0],_=new FormData;_.append("file-to-upload",d),P.post(l,_).then(o=>{this.newImageUrl=o.data.imageUrl,e.value=null}).catch(o=>{console.log(o)})},copyUrl(){const l=document.querySelector("#newImage");navigator.clipboard.writeText(l.value).then(()=>{this.newImageUrl=""}).catch(e=>{console.error("複製失敗",e)})}},watch:{tempProduct(){this.editProduct=this.tempProduct}},mounted(){this.productModal=new k(this.$refs.productModal,"productModal",{keyboard:!1,backdrop:"static"}),this.editProduct=this.tempProduct}},et={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},ot={class:"modal-dialog modal-xl"},st={class:"modal-content border-0"},dt={class:"modal-header bg-dark text-white"},lt={id:"productModalLabel",class:"modal-title"},it={key:0},nt={key:1},rt=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),at={class:"modal-body"},ct={class:"row"},ut={class:"col-sm-4"},pt={class:"mb-3"},mt=t("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),_t=["src"],ht=t("h3",null,"上傳圖片",-1),bt={action:"/api/thisismycourse2/admin/upload",enctype:"multipart/form-data",method:"post"},Pt={class:"input-group mb-3"},gt=t("input",{class:"form-control form-control-sm",id:"formFileSm",type:"file","aria-describedby":"button-addon2"},null,-1),ft={class:"input-group mb-3"},vt=t("h3",{class:"mb-3"},"多圖新增",-1),yt={key:0},Mt={class:"mb-3"},Ut=["for"],wt=["id","onUpdate:modelValue"],xt=["src"],kt={key:0},At={key:1},Vt={class:"col-sm-8"},It={class:"mb-3"},Ct=t("label",{for:"title",class:"form-label"},"標題",-1),Et={class:"row"},Lt={class:"mb-3 col-md-6"},$t=t("label",{for:"category",class:"form-label"},"分類",-1),Nt={class:"mb-3 col-md-6"},Dt=t("label",{for:"unit",class:"form-label"},"單位",-1),Tt={class:"row"},Rt={class:"mb-3 col-md-6"},St=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Ft={class:"mb-3 col-md-6"},Bt=t("label",{for:"price",class:"form-label"},"售價",-1),Ot=t("hr",null,null,-1),qt={class:"mb-3"},zt=t("label",{for:"description",class:"form-label"},"產品描述",-1),jt={class:"mb-3"},Gt=t("label",{for:"content",class:"form-label"},"說明內容",-1),Ht={class:"mb-3"},Jt={class:"form-check"},Kt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Qt={class:"modal-footer"},Wt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Xt(l,e,d,_,o,r){return i(),n("div",et,[t("div",ot,[t("div",st,[t("div",dt,[t("h5",lt,[d.isNew?(i(),n("span",it,"新增產品")):(i(),n("span",nt,"編輯產品"))]),rt]),t("div",at,[t("div",ct,[t("div",ut,[t("div",pt,[mt,a(t("input",{id:"imageUrl","onUpdate:modelValue":e[0]||(e[0]=s=>o.editProduct.imageUrl=s),type:"text",class:"form-control mb-2",placeholder:"請輸入圖片連結"},null,512),[[c,o.editProduct.imageUrl]]),t("img",{class:"img-fluid",src:o.editProduct.imageUrl},null,8,_t)]),ht,t("form",bt,[t("div",Pt,[gt,t("button",{class:"btn btn-outline-primary btn-sm",type:"button",id:"button-addon2",onClick:e[1]||(e[1]=(...s)=>r.uploadFile&&r.uploadFile(...s))},"上傳")]),t("div",ft,[a(t("input",{class:"form-control form-control-sm",type:"text",id:"newImage","onUpdate:modelValue":e[2]||(e[2]=s=>o.newImageUrl=s)},null,512),[[c,o.newImageUrl]]),t("button",{class:"btn btn-outline-primary btn-sm",type:"button",id:"btn",onClick:e[3]||(e[3]=(...s)=>r.copyUrl&&r.copyUrl(...s))}," 複製URL ")])]),vt,Array.isArray(o.editProduct.imagesUrl)?(i(),n("div",yt,[(i(!0),n(g,null,w(o.editProduct.imagesUrl,(s,u)=>(i(),n("div",{class:"mb-1",key:u+456},[t("div",Mt,[t("label",{for:s[u],class:"form-label"},"圖片網址"+m(u+1),9,Ut),a(t("input",{id:s[u],"onUpdate:modelValue":v=>o.editProduct.imagesUrl[u]=v,type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,8,wt),[[c,o.editProduct.imagesUrl[u]]])]),t("img",{class:"img-fluid",src:s},null,8,xt)]))),128)),!o.editProduct.imagesUrl.length||o.editProduct.imagesUrl[o.editProduct.imagesUrl.length-1]?(i(),n("div",kt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[4]||(e[4]=s=>o.editProduct.imagesUrl.push(""))}," 新增圖片 ")])):(i(),n("div",At,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[5]||(e[5]=s=>o.editProduct.imagesUrl.pop())}," 刪除圖片 ")]))])):V("",!0)]),t("div",Vt,[t("div",It,[Ct,a(t("input",{id:"title","onUpdate:modelValue":e[6]||(e[6]=s=>o.editProduct.title=s),type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[c,o.editProduct.title]])]),t("div",Et,[t("div",Lt,[$t,a(t("input",{id:"category","onUpdate:modelValue":e[7]||(e[7]=s=>o.editProduct.category=s),type:"text",class:"form-control",placeholder:"請輸入分類"},null,512),[[c,o.editProduct.category]])]),t("div",Nt,[Dt,a(t("input",{id:"unit","onUpdate:modelValue":e[8]||(e[8]=s=>o.editProduct.unit=s),type:"text",class:"form-control",placeholder:"請輸入單位"},null,512),[[c,o.editProduct.unit]])])]),t("div",Tt,[t("div",Rt,[St,a(t("input",{id:"origin_price","onUpdate:modelValue":e[9]||(e[9]=s=>o.editProduct.origin_price=s),type:"number",min:"0",class:"form-control",placeholder:"請輸入原價"},null,512),[[c,o.editProduct.origin_price,void 0,{number:!0}]])]),t("div",Ft,[Bt,a(t("input",{id:"price","onUpdate:modelValue":e[10]||(e[10]=s=>o.editProduct.price=s),type:"number",min:"0",class:"form-control",placeholder:"請輸入售價"},null,512),[[c,o.editProduct.price,void 0,{number:!0}]])])]),Ot,t("div",qt,[zt,a(t("textarea",{id:"description","onUpdate:modelValue":e[11]||(e[11]=s=>o.editProduct.description=s),type:"text",class:"form-control",placeholder:"請輸入產品描述"},`\r
              `,512),[[c,o.editProduct.description]])]),t("div",jt,[Gt,a(t("textarea",{id:"content","onUpdate:modelValue":e[12]||(e[12]=s=>o.editProduct.content=s),type:"text",class:"form-control",placeholder:"請輸入說明內容"},`\r
              `,512),[[c,o.editProduct.content]])]),t("div",Ht,[t("div",Jt,[a(t("input",{id:"is_enabled","onUpdate:modelValue":e[13]||(e[13]=s=>o.editProduct.is_enabled=s),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[I,o.editProduct.is_enabled]]),Kt])])])])]),t("div",Qt,[Wt,t("button",{type:"button",class:"btn btn-primary",onClick:e[14]||(e[14]=(...s)=>d.updateProduct&&d.updateProduct(...s))}," 確認 ")])])])],512)}const Yt=f(tt,[["render",Xt]]);var Zt={VITE_APP_API_URL:"https://vue3-course-api.hexschool.io",VITE_APP_API_NAME:"langyuanstore",BASE_URL:"/langyuanstore/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:h,VITE_APP_API_NAME:b}=Zt,te={data(){return{products:[],isNew:!1,tempProduct:{imagesUrl:[]},pages:{}}},methods:{getProductList(l=1){const e=`${h}/v2/api/${b}/admin/products?page=${l}`;P.get(e).then(d=>{this.products=d.data.products,this.pages=d.data.pagination}).catch(d=>{console.log(d)})},openModal(l,e){l==="new"?(this.tempProduct={imagesUrl:[]},this.isNew=!0,this.$refs.pModal.openModal()):l==="edit"?(this.tempProduct={...e},Array.isArray(this.tempProduct.imagesUrl)||(this.tempProduct.imagesUrl=[]),this.isNew=!1,this.$refs.pModal.openModal()):l==="delete"&&(this.tempProduct={...e},this.$refs.removeModal.openModal())},updateProduct(){let l=`${h}/v2/api/${b}/admin/product/${this.tempProduct.id}`,e="put";this.isNew&&(l=`${h}/v2/api/${b}/admin/product`,e="post"),P[e](l,{data:this.tempProduct}).then(d=>{alert(d.data.message),this.$refs.pModal.hideModal(),this.getProductList()}).catch(d=>{alert(d.data.message)})},deleteProduct(){const l=`${h}/v2/api/${b}/admin/product/${this.tempProduct.id}`;P.delete(l).then(e=>{alert(e.data.message),this.$refs.removeModal.hideModal(),this.getProductList()}).catch(e=>{alert(e.data.message)})}},components:{DeleteProductModal:B,PaginationComponent:W,ProductsModal:Yt},mounted(){this.getProductList()}},ee={class:"text-end"},oe={class:"table mt-4"},se=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",{width:"120"},"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"100"},"編輯")])],-1),de={class:"text-end"},le={class:"text-end"},ie={key:0,class:"text-success"},ne={key:1},re={class:"btn-group"},ae=["onClick"],ce=["onClick"];function ue(l,e,d,_,o,r){const s=U("PaginationComponent"),u=U("ProductsModal"),v=U("DeleteProductModal");return i(),n(g,null,[t("div",ee,[t("button",{class:"btn btn-primary mt-4",onClick:e[0]||(e[0]=p=>r.openModal("new"))}," 建立新的產品 ")]),t("table",oe,[se,t("tbody",null,[(i(!0),n(g,null,w(o.products,p=>(i(),n("tr",{key:p.id},[t("td",null,m(p.category),1),t("td",null,m(p.title),1),t("td",de,"$"+m(p.origin_price),1),t("td",le,"$"+m(p.price),1),t("td",null,[p.is_enabled?(i(),n("span",ie,"啟用")):(i(),n("span",ne,"未啟用"))]),t("td",null,[t("div",re,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:A=>r.openModal("edit",p)}," 編輯 ",8,ae),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:A=>r.openModal("delete",p)}," 刪除 ",8,ce)])])]))),128))])]),M(s,{pages:o.pages,"get-product-list":r.getProductList},null,8,["pages","get-product-list"]),M(u,{"update-product":r.updateProduct,"temp-product":o.tempProduct,isNew:o.isNew,ref:"pModal"},null,8,["update-product","temp-product","isNew"]),M(v,{"temp-product":o.tempProduct,"delete-product":r.deleteProduct,ref:"removeModal"},null,8,["temp-product","delete-product"])],64)}const he=f(te,[["render",ue]]);export{he as default};
